<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroPython t-string</title>
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">
    <script type="module">
        import './static/polyscript/index.js';

        const mpy = document.querySelector('script[type="mpy"]');
        mpy.setAttribute('version', new URL('./static/micropython.mjs', location));
        mpy.type = 'micropython';
    </script>
    <style>
.row {
  display: flex;
}

.column, .editor {
  flex: 50%;
}
    </style>
</head>
<body>
<div>Status: <span id="loader">Starting</span></div>
<div id="output" title="Example Output"></div>
<script type="mpy" config="./config.toml">
    from js import document, cm6, DOMParser
    from examples import main

    loader = document.getElementById("loader")
    output = document.getElementById("output")
    loader.textContent = "Loading"
    try:
        stories = main()
        for story in stories:
            loader.textContent = "Loaded"
            story_path = story["path"]
            new_example = document.createElement("div", {"id": story_path})
            new_example.innerHTML = story["rendered"]
            output.append(new_example)

            # Grab the newly inserted example and initialize it as an editor
            initialState = cm6.createEditorState(story["code"])
            target_query = f"section[title='{story_path}'] div.editor"
            target = document.querySelector(target_query)
            view = cm6.createEditorView(initialState, target);
    except IndexError as e:
        loader.textContent = str(e)
</script>
<script src="./static/cmd6.bundle.js"></script>
<script>
    // Create an initial state for the view

    // const initialState = cm6.createEditorState("function foo() {\n    console.log(123);\n}");
    // const view = cm6.createEditorView(initialState, document.getElementById("editor"));
    //
    // // Programmatically change editor contents
    // console.log("Before:\n", view.state.doc.toString())
    // view.dispatch({changes: {from: 0, insert: "// Programmatically add a comment to the first line\n"}})
    // console.log("After:\n", view.state.doc.toString())
</script>
</body>
</html>